import{D as ue}from"./chunk-YRY2CZ6I-IK5lcTTd.js";import{A as xe}from"./chunk-AYAWUL3C-D3mYCUhF.js";import{R as E}from"./chunk-Q7YRCENL-C9mvGtoV.js";import{D as ee,C as he}from"./chunk-EMJCDNY5-CydvCcBo.js";import{g as fe}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{j as e,r as _,b as ge,a8 as ye,d9 as je,t as T,o as g,da as _e,v as o,H as be,Y as ve,E as p,I as te,T as B,D as F,aa as Ce,B as M,ab as Ne,ac as i}from"./index-CfFT3zi1.js";import"./chunk-GZBFGV7Y-Se72An9a.js";import{K as we}from"./chunk-6HTZNHPT-BcSjToUL.js";import{R as y,u as Fe}from"./chunk-4TC5YS65-Um6ptYuI.js";import{T as k}from"./Trans-9Tf8C9WY.js";import{P as h}from"./progress-tabs-BG5tNCDJ.js";import{R as d}from"./radio-group-BVHtHML1.js";import{A as Ie}from"./alert-DcMcEDC4.js";import{C as Re}from"./currency-input-BRRQzzSW.js";import"./index.esm-DbViPNyb.js";import"./chunk-TDDYKNA2-BfVPXb8C.js";import"./textarea-DHQJkmik.js";import"./date-picker-OUZSlUXd.js";import"./clsx-B-dksMZM.js";import"./popover-Jap1wZaP.js";import"./index-DSzuN2X_.js";import"./x-mark-mini-MvZodUZ3.js";import"./triangle-left-mini-Cqpo5cQq.js";import"./select-7ZH_AviM.js";import"./check-Bwfm9_1S.js";import"./triangles-mini-C3n3c70C.js";import"./chunk-HFB3OQXI-C8lnk72_.js";import"./chunk-F6ZOHZVB-CvJzOXLs.js";import"./plus-mini-BHgsEJRM.js";import"./prompt-hJIgjWBE.js";import"./index-B-oTeFUj.js";var A=i.array(i.object({id:i.string().optional(),attribute:i.string().min(1,{message:"Required field"}),operator:i.string().min(1,{message:"Required field"}),values:i.union([i.number().min(1,{message:"Required field"}),i.string().min(1,{message:"Required field"}),i.array(i.string()).min(1,{message:"Required field"})]),required:i.boolean().optional(),disguised:i.boolean().optional(),field_type:i.string().optional()})),De=i.object({template_id:i.string().optional(),campaign_id:i.string().optional(),campaign_choice:i.enum(["none","existing","new"]).optional(),is_automatic:i.string().toLowerCase(),code:i.string().min(1),type:i.enum(["buyget","standard"]),status:i.enum(["draft","active","inactive"]),rules:A,is_tax_inclusive:i.boolean().optional(),application_method:i.object({allocation:i.enum(["each","across"]),value:i.number().min(0),currency_code:i.string().optional(),max_quantity:i.number().optional().nullable(),target_rules:A,buy_rules:A,type:i.enum(["fixed","percentage"]),target_type:i.enum(["order","shipping_methods","items"])}),campaign:he.optional()}).refine(f=>f.application_method.allocation==="across"?!0:f.application_method.allocation==="each"&&typeof f.application_method.max_quantity=="number",{path:["application_method.max_quantity"],message:"required field"}),b=["type","application_method.type","application_method.allocation"],L=[{id:"amount_off_products",type:"standard",title:"Amount off products",description:"Discount specific products or collection of products",hiddenFields:[...b],defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"fixed"}}},{id:"amount_off_order",type:"standard",title:"Amount off order",description:"Discounts the total order amount",hiddenFields:[...b],defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"fixed"}}},{id:"percentage_off_product",type:"standard",title:"Percentage off product",description:"Discounts a percentage off selected products",hiddenFields:[...b],defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"each",target_type:"items",type:"percentage"}}},{id:"percentage_off_order",type:"standard",title:"Percentage off order",description:"Discounts a percentage of the total order amount",hiddenFields:[...b],defaults:{is_automatic:"false",type:"standard",application_method:{allocation:"across",target_type:"order",type:"percentage"}}},{id:"buy_get",type:"buy_get",title:"Buy X Get Y",description:"Buy X product(s), get Y product(s)",hiddenFields:[...b,"application_method.value","is_tax_inclusive"],defaults:{is_automatic:"false",type:"buyget",application_method:{type:"percentage",value:100,apply_to_quantity:1,max_quantity:1}}}],oe={campaign_id:void 0,template_id:L[0].id,campaign_choice:"none",is_automatic:"false",code:"",type:"standard",status:"draft",rules:[],is_tax_inclusive:!1,application_method:{allocation:"each",type:"fixed",target_type:"items",max_quantity:1,target_rules:[],buy_rules:[]},campaign:void 0},Se=()=>{var U,$,G,Y,X;const[f,v]=_.useState("type"),[I,C]=_.useState({type:"in-progress",promotion:"not-started",campaign:"not-started"}),{t:a}=ge(),{handleSuccess:ae}=Fe(),s=ye({defaultValues:oe,resolver:Ne(De)}),{setValue:u,reset:z,getValues:P}=s,{mutateAsync:se}=je(),ie=s.handleSubmit(async t=>{const{campaign_choice:r,is_automatic:l,is_tax_inclusive:m,template_id:x,application_method:ce,rules:Q,...de}=t,{target_rules:W=[],buy_rules:J=[],...me}=ce,pe=[...W.filter(c=>!!c.disguised),...J.filter(c=>!!c.disguised),...Q.filter(c=>!!c.disguised)],Z={};for(const c of pe)Z[c.attribute]=c.field_type==="number"?parseInt(c.values):c.values;const q=c=>c.filter(j=>!j.disguised).map(j=>({operator:j.operator,attribute:j.attribute,values:j.values}));se({...de,rules:q(Q),application_method:{...me,...Z,target_rules:q(W),buy_rules:q(J)},is_tax_inclusive:m,is_automatic:l==="true"},{onSuccess:({promotion:c})=>{T.success(a("promotions.toasts.promotionCreateSuccess",{code:c.code})),ae(`/promotions/${c.id}`)},onError:c=>{T.error(c.message)}})},async t=>{const{campaign:r,...l}=t||{};!!Object.keys(l||{}).length&&T.error(a("promotions.errors.promotionTabError"))}),R=async t=>{switch(t){case"type":C(r=>({...r,type:"in-progress"})),v(t);break;case"promotion":C(r=>({...r,type:"completed",promotion:"in-progress"})),v(t);break;case"campaign":{if(!await s.trigger()){C({type:"completed",promotion:"in-progress",campaign:"not-started"}),v("promotion");break}C(l=>({...l,promotion:"completed",campaign:"in-progress"})),v(t);break}}},re=async()=>{switch(f){case"type":R("promotion");break;case"promotion":{await s.trigger()&&R("campaign");break}}},D=g({control:s.control,name:"template_id"}),n=_.useMemo(()=>{const t=L.find(r=>r.id===D);if(t){z({...oe,template_id:D});for(const[r,l]of Object.entries(t.defaults))if(typeof l=="object")for(const[m,x]of Object.entries(l))u(`application_method.${m}`,x);else u(r,l);return t}},[D,u,z]),N=g({control:s.control,name:"application_method.type"})==="fixed",S=g({control:s.control,name:"application_method.allocation"});_.useEffect(()=>{S==="across"&&u("application_method.max_quantity",null)},[S,u]);const V=g({control:s.control,name:"type"})==="standard",ne=g({control:s.control,name:"application_method.target_type"})==="order",K=s.getValues();let H={};N&&K.application_method.currency_code&&(H={budget:{currency_code:K.application_method.currency_code}});const{campaigns:le}=_e(H),w=g({control:s.control,name:"campaign_choice"});_.useEffect(()=>{var r,l;const t=P();w!=="existing"&&u("campaign_id",void 0),w!=="new"&&u("campaign",void 0),w==="new"&&(!t.campaign||!((l=(r=t.campaign)==null?void 0:r.budget)!=null&&l.type))&&u("campaign",{...ee,budget:{...ee.budget,currency_code:t.application_method.currency_code}})},[w,P,u]);const O=g({control:s.control,name:"rules"}).find(t=>t.attribute==="currency_code");if(O){const r=s.getValues().application_method.currency_code,l=O.values;!Array.isArray(l)&&r!==l&&s.setValue("application_method.currency_code",l)}return e.jsx(y.Form,{form:s,children:e.jsxs(we,{className:"flex h-full flex-col",onSubmit:ie,children:[e.jsxs(h,{value:f,onValueChange:t=>R(t),className:"flex h-full flex-col overflow-hidden",children:[e.jsx(y.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(h.List,{className:"grid w-full grid-cols-3",children:[e.jsx(h.Trigger,{className:"w-full",value:"type",status:I.type,children:a("promotions.tabs.template")}),e.jsx(h.Trigger,{className:"w-full",value:"promotion",status:I.promotion,children:a("promotions.tabs.details")}),e.jsx(h.Trigger,{className:"w-full",value:"campaign",status:I.campaign,children:a("promotions.tabs.campaign")})]})})})}),e.jsxs(y.Body,{className:"size-full overflow-hidden",children:[e.jsx(h.Content,{value:"type",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsx("div",{className:"w-full max-w-[720px] py-16",children:e.jsx(o.Field,{control:s.control,name:"template_id",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.type")}),e.jsx(o.Control,{children:e.jsx(d,{className:"flex-col gap-y-3",...t,onValueChange:t.onChange,children:L.map(r=>e.jsx(d.ChoiceBox,{value:r.id,label:r.title,description:r.description},r.id))},"template_id")}),e.jsx(o.ErrorMessage,{})]})})})})}),e.jsx(h.Content,{value:"promotion",className:"size-full overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:[e.jsxs(be,{level:"h1",className:"text-fg-base",children:[a("promotions.sections.details"),(n==null?void 0:n.title)&&e.jsx(ve,{className:"ml-2 align-middle",color:"grey",size:"2xsmall",rounded:"full",children:n==null?void 0:n.title})]}),s.formState.errors.root&&e.jsx(Ie,{variant:"error",dismissible:!1,className:"text-balance",children:s.formState.errors.root.message}),e.jsx(o.Field,{control:s.control,name:"is_automatic",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.form.method.label")}),e.jsx(o.Control,{children:e.jsxs(d,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(d.ChoiceBox,{value:"false",label:a("promotions.form.method.code.title"),description:a("promotions.form.method.code.description"),className:p("basis-1/2")}),e.jsx(d.ChoiceBox,{value:"true",label:a("promotions.form.method.automatic.title"),description:a("promotions.form.method.automatic.description"),className:p("basis-1/2")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:s.control,name:"status",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.form.status.label")}),e.jsx(o.Control,{children:e.jsxs(d,{className:"flex gap-y-3",...t,value:t.value,onValueChange:t.onChange,children:[e.jsx(d.ChoiceBox,{value:"draft",label:a("promotions.form.status.draft.title"),description:a("promotions.form.status.draft.description"),className:p("basis-1/2")}),e.jsx(d.ChoiceBox,{value:"active",label:a("promotions.form.status.active.title"),description:a("promotions.form.status.active.description"),className:p("basis-1/2")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx("div",{className:"flex gap-y-4",children:e.jsx(o.Field,{control:s.control,name:"code",render:({field:t})=>e.jsxs(o.Item,{className:"basis-1/2",children:[e.jsx(o.Label,{children:a("promotions.form.code.title")}),e.jsx(o.Control,{children:e.jsx(te,{...t,placeholder:"SUMMER15"})}),e.jsx(B,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(k,{t:a,i18nKey:"promotions.form.code.description",components:[e.jsx("br",{},"break")]})})]})})}),!((U=n==null?void 0:n.hiddenFields)!=null&&U.includes("is_tax_inclusive"))&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("div",{className:"flex gap-x-2 gap-y-4",children:e.jsx(o.Field,{control:s.control,name:"is_tax_inclusive",render:({field:{onChange:t,value:r,...l}})=>e.jsxs(o.Item,{className:"basis-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"block",children:[e.jsx(o.Label,{children:a("promotions.form.taxInclusive.title")}),e.jsx(o.Hint,{className:"!mt-1",children:a("promotions.form.taxInclusive.description")})]}),e.jsx(o.Control,{className:"mr-2 self-center",children:e.jsx(Ce,{className:"mt-[2px]",checked:!!r,onCheckedChange:t,...l})})]}),e.jsx(o.ErrorMessage,{})]})})})]}),!(($=n==null?void 0:n.hiddenFields)!=null&&$.includes("type"))&&e.jsx(o.Field,{control:s.control,name:"type",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.type")}),e.jsx(o.Control,{children:e.jsxs(d,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(d.ChoiceBox,{value:"standard",label:a("promotions.form.type.standard.title"),description:a("promotions.form.type.standard.description"),className:p("basis-1/2")}),e.jsx(d.ChoiceBox,{value:"buyget",label:a("promotions.form.type.buyget.title"),description:a("promotions.form.type.buyget.description"),className:p("basis-1/2")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(F,{}),e.jsx(E,{form:s,ruleType:"rules"}),e.jsx(F,{}),!((G=n==null?void 0:n.hiddenFields)!=null&&G.includes("application_method.type"))&&e.jsx(o.Field,{control:s.control,name:"application_method.type",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.value_type")}),e.jsx(o.Control,{children:e.jsxs(d,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(d.ChoiceBox,{value:"fixed",label:a("promotions.form.value_type.fixed.title"),description:a("promotions.form.value_type.fixed.description"),className:p("basis-1/2")}),e.jsx(d.ChoiceBox,{value:"percentage",label:a("promotions.form.value_type.percentage.title"),description:a("promotions.form.value_type.percentage.description"),className:p("basis-1/2")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsxs("div",{className:"flex gap-x-2 gap-y-4",children:[!((Y=n==null?void 0:n.hiddenFields)!=null&&Y.includes("application_method.value"))&&e.jsx(o.Field,{control:s.control,name:"application_method.value",render:({field:{onChange:t,value:r,...l}})=>{const m=s.getValues().application_method.currency_code;return e.jsxs(o.Item,{className:"basis-1/2",children:[e.jsx(o.Label,{tooltip:m||!N?void 0:a("promotions.fields.amount.tooltip"),children:a("promotions.form.value.title")}),e.jsx(o.Control,{children:N?e.jsx(Re,{...l,min:0,onValueChange:x=>{t(x?parseInt(x):"")},code:m||"USD",symbol:m?fe(m):"$",value:r,disabled:!m}):e.jsx(ue,{className:"text-right",min:0,max:100,...l,value:r,onChange:x=>{t(x.target.value===""?null:parseInt(x.target.value))}},"amount")}),e.jsx(B,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(k,{t:a,i18nKey:N?"promotions.form.value_type.fixed.description":"promotions.form.value_type.percentage.description",components:[e.jsx("br",{},"break")]})}),e.jsx(o.ErrorMessage,{})]})}}),V&&S==="each"&&e.jsx(o.Field,{control:s.control,name:"application_method.max_quantity",render:({field:t})=>e.jsxs(o.Item,{className:"basis-1/2",children:[e.jsx(o.Label,{children:a("promotions.form.max_quantity.title")}),e.jsx(o.Control,{children:e.jsx(te,{...s.register("application_method.max_quantity",{valueAsNumber:!0}),type:"number",min:1,placeholder:"3"})}),e.jsx(B,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:e.jsx(k,{t:a,i18nKey:"promotions.form.max_quantity.description",components:[e.jsx("br",{},"break")]})})]})})]}),V&&!((X=n==null?void 0:n.hiddenFields)!=null&&X.includes("application_method.allocation"))&&e.jsx(o.Field,{control:s.control,name:"application_method.allocation",render:({field:t})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:a("promotions.fields.allocation")}),e.jsx(o.Control,{children:e.jsxs(d,{className:"flex gap-y-3",...t,onValueChange:t.onChange,children:[e.jsx(d.ChoiceBox,{value:"each",label:a("promotions.form.allocation.each.title"),description:a("promotions.form.allocation.each.description"),className:p("basis-1/2")}),e.jsx(d.ChoiceBox,{value:"across",label:a("promotions.form.allocation.across.title"),description:a("promotions.form.allocation.across.description"),className:p("basis-1/2")})]})}),e.jsx(o.ErrorMessage,{})]})}),!V&&e.jsx(e.Fragment,{children:e.jsx(E,{form:s,ruleType:"buy-rules",scope:"application_method.buy_rules"})}),!ne&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(E,{form:s,ruleType:"target-rules",scope:"application_method.target_rules"})]})]})})}),e.jsx(h.Content,{value:"campaign",className:"size-full overflow-auto",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 py-16",children:e.jsx(xe,{form:s,campaigns:le||[]})})})})]})]}),e.jsx(y.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(y.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:a("actions.cancel")})}),f==="campaign"?e.jsx(M,{type:"submit",size:"small",isLoading:!1,children:a("actions.save")},"save-btn"):e.jsx(M,{type:"button",onClick:re,size:"small",children:a("actions.continue")},"continue-btn")]})})]})})},pt=()=>e.jsx(y,{children:e.jsx(Se,{})});export{pt as Component};
