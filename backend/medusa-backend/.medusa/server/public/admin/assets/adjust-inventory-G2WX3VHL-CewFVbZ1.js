import{c as _}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as I}from"./chunk-6HTZNHPT-HdCSFFuD.js";import{b as d,u as L}from"./chunk-4TC5YS65-DbRS9JYZ.js";import{R as w,b as q,dW as N,aZ as S,j as e,H as F,a6 as r,a8 as C,a9 as R,v as z,e2 as A,t as g,w as l,x as E,B as b,T as k}from"./index-DvK3t9V2.js";import"./prompt-CAU7MXNM.js";var u=({title:n,value:s})=>e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(k,{className:"px-2 py-1.5",size:"small",leading:"compact",children:n}),e.jsx(k,{className:"px-2 py-1.5",size:"small",leading:"compact",children:s})]}),Q=({item:n,level:s,location:x})=>{const{t}=q(),{handleSuccess:v}=L(),j=r.object({stocked_quantity:r.union([r.number(),r.string()])}).superRefine((o,i)=>{const y=o.stocked_quantity?_(o.stocked_quantity):null;if(y===null){i.addIssue({code:r.ZodIssueCode.invalid_type,expected:"number",received:"undefined",path:["stocked_quantity"]});return}y<s.reserved_quantity&&i.addIssue({code:r.ZodIssueCode.custom,message:t("inventory.adjustInventory.errors.stockedQuantity",{quantity:s.reserved_quantity}),path:["stocked_quantity"]})}),a=C({defaultValues:{stocked_quantity:s.stocked_quantity},resolver:R(j)}),c=z({control:a.control,name:"stocked_quantity"}),m=c?_(c)-s.reserved_quantity:0-s.reserved_quantity,{mutateAsync:h,isPending:f}=A(n.id,s.location_id),p=a.handleSubmit(async o=>{await h({stocked_quantity:_(o.stocked_quantity)},{onSuccess:()=>{g.success(t("inventory.toast.updateLevel")),v()},onError:i=>{g.error(i.message)}})});return e.jsx(d.Form,{form:a,children:e.jsxs(I,{onSubmit:p,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(d.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-4 divide-y rounded-lg border",children:[e.jsx(u,{title:t("fields.title"),value:n.title??"-"}),e.jsx(u,{title:t("fields.sku"),value:n.sku}),e.jsx(u,{title:t("locations.domain"),value:x.name}),e.jsx(u,{title:t("inventory.reserved"),value:s.reserved_quantity}),e.jsx(u,{title:t("inventory.available"),value:m})]}),e.jsx(l.Field,{control:a.control,name:"stocked_quantity",render:({field:{onChange:o,value:i,...y}})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{children:t("fields.inStock")}),e.jsx(l.Control,{children:e.jsx(E,{type:"number",value:i,onChange:o,...y})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsx(d.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(b,{type:"submit",size:"small",isLoading:f,children:t("actions.save")})]})})]})})},D=()=>{const{id:n,location_id:s}=w(),{t:x}=q(),{inventory_item:t,isPending:v,isError:j,error:a}=N(n),c=t==null?void 0:t.location_levels.find(p=>p.location_id===s),{stock_location:m,isLoading:h}=S(s),f=!v&&t&&c&&!h&&m;if(j)throw a;return e.jsxs(d,{children:[e.jsx(d.Header,{children:e.jsx(F,{children:x("inventory.manageLocationQuantity")})}),f&&e.jsx(Q,{item:t,level:c,location:m})]})};export{D as Component};
