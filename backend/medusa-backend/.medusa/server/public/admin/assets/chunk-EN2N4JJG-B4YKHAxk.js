import{o as p,a as w}from"./chunk-ZQRKUG6J-D74iDRCm.js";import{F}from"./chunk-TYTNUPXB-DJaW19WI.js";import{c as m}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{a6 as i,an as E,b as x,r as y,j as s,w as c}from"./index-DvK3t9V2.js";var M=e=>{var t,a,g,l,d,u,_,h,f,b;const n=(a=(t=e.media)==null?void 0:t.find(o=>o.isThumbnail))==null?void 0:a.url,r=(g=e.media)==null?void 0:g.filter(o=>!o.isThumbnail).map(o=>({url:o.url}));return{status:e.status,is_giftcard:!1,tags:(l=e==null?void 0:e.tags)!=null&&l.length?(d=e.tags)==null?void 0:d.map(o=>({id:o})):void 0,sales_channels:(u=e==null?void 0:e.sales_channels)!=null&&u.length?(_=e.sales_channels)==null?void 0:_.map(o=>({id:o.id})):void 0,images:r,collection_id:e.collection_id||void 0,shipping_profile_id:e.shipping_profile_id||void 0,categories:e.categories.map(o=>({id:o})),type_id:e.type_id||void 0,handle:(h=e.handle)==null?void 0:h.trim(),origin_country:e.origin_country||void 0,material:e.material||void 0,mid_code:e.mid_code||void 0,hs_code:e.hs_code||void 0,thumbnail:n,title:e.title.trim(),subtitle:(f=e.subtitle)==null?void 0:f.trim(),description:(b=e.description)==null?void 0:b.trim(),discountable:e.discountable,width:e.width?parseFloat(e.width):void 0,length:e.length?parseFloat(e.length):void 0,height:e.height?parseFloat(e.height):void 0,weight:e.weight?parseFloat(e.weight):void 0,options:e.options.filter(o=>o.title),variants:S(e.variants.filter(o=>o.should_create),e.regionsCurrencyMap)}},S=(e,n)=>e.map(r=>({title:r.title||Object.values(r.options||{}).join(" / "),options:r.options,sku:r.sku||void 0,manage_inventory:!!r.manage_inventory,allow_backorder:!!r.allow_backorder,variant_rank:r.variant_rank,inventory_items:r.inventory.map(t=>{const a=t.required_quantity?m(t.required_quantity):null;return!t.inventory_item_id||!a?!1:{...t,required_quantity:a}}).filter(t=>t!==!1),prices:Object.entries(r.prices||{}).map(([t,a])=>{if(!(a===""||a===void 0))return t.startsWith("reg_")?{currency_code:n[t],amount:m(a),rules:{region_id:t}}:{currency_code:t,amount:m(a)}}).filter(t=>!!t)})),T=e=>e.map(n=>({...n,title:n.title||"",sku:n.sku||"",manage_inventory:n.manage_inventory||!1,allow_backorder:n.allow_backorder||!1,inventory_kit:n.inventory_kit||!1})),k=i.object({id:i.string().optional(),url:i.string(),isThumbnail:i.boolean(),file:i.any().nullable()}),q=i.object({should_create:i.boolean(),is_default:i.boolean().optional(),title:i.string(),upc:i.string().optional(),ean:i.string().optional(),barcode:i.string().optional(),mid_code:i.string().optional(),hs_code:i.string().optional(),width:p,height:p,length:p,weight:p,material:i.string().optional(),origin_country:i.string().optional(),sku:i.string().optional(),manage_inventory:i.boolean().optional(),allow_backorder:i.boolean().optional(),inventory_kit:i.boolean().optional(),options:i.record(i.string(),i.string()),variant_rank:i.number(),prices:i.record(i.string(),w).optional(),inventory:i.array(i.object({inventory_item_id:i.string(),required_quantity:p})).optional()}),I=i.object({title:i.string(),values:i.array(i.string()).min(1)}),U=i.object({title:i.string().min(1),subtitle:i.string().optional(),handle:i.string().optional(),description:i.string().optional(),discountable:i.boolean(),type_id:i.string().optional(),collection_id:i.string().optional(),shipping_profile_id:i.string().optional(),categories:i.array(i.string()),tags:i.array(i.string()).optional(),sales_channels:i.array(i.object({id:i.string(),name:i.string()})).optional(),origin_country:i.string().optional(),material:i.string().optional(),width:i.string().optional(),length:i.string().optional(),height:i.string().optional(),weight:i.string().optional(),mid_code:i.string().optional(),hs_code:i.string().optional(),options:i.array(I).min(1),enable_variants:i.boolean(),variants:i.array(q).min(1),media:i.array(k).optional()}).superRefine((e,n)=>{if(e.variants.every(t=>!t.should_create))return n.addIssue({code:i.ZodIssueCode.custom,path:["variants"],message:"invalid_length"});const r=new Set;e.variants.forEach((t,a)=>{t.sku&&(r.has(t.sku)&&n.addIssue({code:i.ZodIssueCode.custom,path:[`variants.${a}.sku`],message:E.t("products.create.errors.uniqueSku")}),r.add(t.sku))})}),N=i.object({media:i.array(k)}),V={discountable:!0,tags:[],sales_channels:[],options:[{title:"Default option",values:["Default option value"]}],variants:T([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]),enable_variants:!1,media:[],categories:[],collection_id:"",shipping_profile_id:"",description:"",handle:"",height:"",hs_code:"",length:"",material:"",mid_code:"",origin_country:"",subtitle:"",title:"",type_id:"",weight:"",width:""},j=["image/jpeg","image/png","image/gif","image/webp","image/heic","image/svg+xml"],C=[".jpeg",".png",".gif",".webp",".heic",".svg"],A=({form:e,append:n,showHint:r=!0})=>{const{t}=x(),a=y.useCallback(l=>{const d=l.find(u=>!j.includes(u.file.type));return d?(e.setError("media",{type:"invalid_file",message:t("products.media.invalidFileType",{name:d.file.name,types:C.join(", ")})}),!0):!1},[e,t]),g=y.useCallback(l=>{e.clearErrors("media"),!a(l)&&l.forEach(d=>n({...d,isThumbnail:!1}))},[e,n,a]);return s.jsx(c.Field,{control:e.control,name:"media",render:()=>s.jsx(c.Item,{children:s.jsxs("div",{className:"flex flex-col gap-y-2",children:[s.jsxs("div",{className:"flex flex-col gap-y-1",children:[s.jsx(c.Label,{optional:!0,children:t("products.media.label")}),r&&s.jsx(c.Hint,{children:t("products.media.editHint")})]}),s.jsx(c.Control,{children:s.jsx(F,{label:t("products.media.uploadImagesLabel"),hint:t("products.media.uploadImagesHint"),hasError:!!e.formState.errors.media,formats:j,onUploaded:g})}),s.jsx(c.ErrorMessage,{})]})})})};export{N as E,V as P,A as U,U as a,T as d,M as n};
