import{u as $,a as q,b as G}from"./chunk-NOAFLTPV-mjXnFST2.js";import{f as Q}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{u as U,_ as W}from"./chunk-B2JT2FOA-CCViXYPj.js";import{g as Z,j as e,r as E,a8 as J,o as Y,b as ee,e8 as se,t as w,cM as N,B as x,E as re,H as ie,T as p,v as r,I as te,aa as T,ab as ae,a2 as R,ad as k,a3 as I,a4 as j}from"./index-DuPjH3KB.js";import"./lodash-ClScSccc.js";import{C as oe}from"./chunk-GZBFGV7Y-DqtB2grq.js";import{c as ne}from"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-GJUPECDU-B9CfnovH.js";import{K as le}from"./chunk-6HTZNHPT-Cb4WOymP.js";import{R as g,a as ce,u as de,S as u}from"./chunk-4TC5YS65-CpYb4tqr.js";import{b as me}from"./chunk-F3G43K3W-DVgy7F4X.js";import{X as ue}from"./x-mark-mini-DYq8yXaN.js";import{S as f}from"./select-B6y84Gu9.js";import{c as xe}from"./index-S6MJuDVs.js";import{C as P}from"./checkbox-Bk9tWoiH.js";import"./chunk-C76H5USB-DSAXxusX.js";import"./chunk-YEDAFXMB-DfcKMDYE.js";import"./chunk-AOFGTNG6-CAIsojnw.js";import"./table-CscvYbVG.js";import"./chunk-EMIHDNB7-DBG0xwmB.js";import"./plus-mini-CHt0yZCy.js";import"./command-bar-I2MBAqH4.js";import"./index-BYlQIoOd.js";import"./triangles-mini-DJ6fWUKd.js";import"./chunk-PFKKVLZX-DKaci4F0.js";import"./format-CYz8zicf.js";import"./_isIndex-CRzpbhu3.js";import"./index-C3GbMNtI.js";import"./date-picker-DMpeerFX.js";import"./clsx-B-dksMZM.js";import"./popover-BYMYJd1X.js";import"./triangle-left-mini-BWlUUW7A.js";import"./prompt-BdJTBwZe.js";import"./check-DLMe1STM.js";var he=R({name:j().min(1),currency_code:j().min(2,"Select a currency"),automatic_taxes:I(),is_tax_inclusive:I(),countries:k(R({code:j(),name:j()})),payment_providers:k(j()).min(1)}),b="cr",C=50,z="countries-modal",pe=({currencies:n,paymentProviders:a})=>{const{setIsOpen:m}=ce(),[c,h]=E.useState({}),{handleSuccess:v}=de(),o=J({defaultValues:{name:"",currency_code:"",automatic_taxes:!0,is_tax_inclusive:!1,countries:[],payment_providers:[]},resolver:ae(he)}),y=Y({control:o.control,name:"countries",defaultValue:[]}),{t}=ee(),{mutateAsync:F,isPending:M}=se(),H=o.handleSubmit(async s=>{await F({name:s.name,countries:s.countries.map(i=>i.code),currency_code:s.currency_code,payment_providers:s.payment_providers,automatic_taxes:s.automatic_taxes,is_tax_inclusive:s.is_tax_inclusive},{onSuccess:({region:i})=>{w.success(t("regions.toast.create")),v(`../${i.id}`)},onError:i=>{w.error(i.message)}})}),{searchParams:D,raw:L}=$({pageSize:C,prefix:b}),{countries:A,count:_}=q({countries:N.map((s,i)=>({display_name:s.display_name,name:s.name,id:i,iso_2:s.iso_2,iso_3:s.iso_3,num_code:s.num_code,region_id:null,region:{}})),...D}),S=fe(),{table:V}=U({data:A||[],columns:S,count:_,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:c,updater:h},getRowId:s=>s.iso_2,pageSize:C,prefix:b}),B=()=>{const s=Object.keys(c).filter(i=>c[i]);o.setValue("countries",s.map(i=>({code:i,name:N.find(d=>d.iso_2===i).display_name})),{shouldDirty:!0,shouldTouch:!0}),m(z,!1)},O=s=>{const i=y.filter(l=>l.code!==s),d=i.map(l=>l.code).reduce((l,X)=>(l[X]=!0,l),{});o.setValue("countries",i,{shouldDirty:!0,shouldTouch:!0}),h(d)},K=()=>{o.setValue("countries",[],{shouldDirty:!0,shouldTouch:!0}),h({})};return e.jsx(g.Form,{form:o,children:e.jsxs(le,{className:"flex h-full flex-col overflow-hidden",onSubmit:H,children:[e.jsx(g.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(g.Close,{asChild:!0,children:e.jsx(x,{size:"small",variant:"secondary",children:t("actions.cancel")})}),e.jsx(x,{size:"small",type:"submit",isLoading:M,children:t("actions.save")})]})}),e.jsx(g.Body,{className:"flex overflow-hidden",children:e.jsx("div",{className:re("flex h-full w-full flex-col items-center overflow-y-auto p-16"),id:"form-section",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(ie,{children:t("regions.createRegion")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.createRegionHint")})]}),e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:o.control,name:"name",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.name")}),e.jsx(r.Control,{children:e.jsx(te,{...s})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:o.control,name:"currency_code",render:({field:{onChange:s,ref:i,...d}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.currency")}),e.jsx(r.Control,{children:e.jsxs(f,{...d,onValueChange:s,children:[e.jsx(f.Trigger,{ref:i,children:e.jsx(f.Value,{})}),e.jsx(f.Content,{children:n.map(l=>e.jsx(f.Item,{value:l.code,children:l.name},l.code))})]})}),e.jsx(r.ErrorMessage,{})]})})]})}),e.jsx(r.Field,{control:o.control,name:"automatic_taxes",render:({field:{value:s,onChange:i,...d}})=>e.jsx(r.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r.Label,{children:t("fields.automaticTaxes")}),e.jsx(r.Control,{children:e.jsx(T,{...d,checked:s,onCheckedChange:i})})]}),e.jsx(r.Hint,{children:t("regions.automaticTaxesHint")}),e.jsx(r.ErrorMessage,{})]})})}),e.jsx(r.Field,{control:o.control,name:"is_tax_inclusive",render:({field:{value:s,onChange:i,...d}})=>e.jsx(r.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(r.Label,{children:t("fields.taxInclusivePricing")}),e.jsx(r.Control,{children:e.jsx(T,{...d,checked:s,onCheckedChange:i})})]}),e.jsx(r.Hint,{children:t("regions.taxInclusiveHint")}),e.jsx(r.ErrorMessage,{})]})})}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:t("fields.countries")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.countriesHint")})]}),y.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[y.map(s=>e.jsx(ge,{country:s,onRemove:O},s.code)),e.jsx(x,{variant:"transparent",size:"small",className:"text-ui-fg-muted hover:text-ui-fg-subtle",onClick:K,children:t("actions.clearAll")})]}),e.jsxs(u,{id:z,children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(u.Trigger,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:t("regions.addCountries")})})}),e.jsx(u.Content,{children:e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(u.Header,{children:e.jsx(u.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("regions.addCountries")})})}),e.jsx(u.Body,{className:"overflow-hidden",children:e.jsx(W,{table:V,columns:S,count:_,pageSize:C,orderBy:[{key:"display_name",label:t("fields.name")},{key:"iso_2",label:t("fields.code")}],pagination:!0,search:"autofocus",layout:"fill",queryObject:L,prefix:b})}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(x,{size:"small",type:"button",onClick:B,children:t("actions.save")})]})})]})})]})]}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:t("fields.providers")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.providersHint")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(r.Field,{control:o.control,name:"payment_providers",render:({field:s})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t("fields.paymentProviders")}),e.jsx(r.Control,{children:e.jsx(oe,{options:a.map(i=>({label:Q(i.id),value:i.id})),...s})}),e.jsx(r.ErrorMessage,{})]})})})]})]})})})]})})},je=xe(),fe=()=>{const n=G();return E.useMemo(()=>[je.display({id:"select",header:({table:a})=>e.jsx(P,{checked:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),onCheckedChange:m=>a.toggleAllPageRowsSelected(!!m)}),cell:({row:a})=>{const m=!a.getCanSelect();return e.jsx(P,{checked:a.getIsSelected()||m,disabled:m,onCheckedChange:c=>a.toggleSelected(!!c),onClick:c=>{c.stopPropagation()}})}}),...n],[n])},ge=({country:n,onRemove:a})=>e.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base transition-fg hover:bg-ui-bg-field-hover flex h-7 items-center overflow-hidden rounded-md",children:[e.jsx("div",{className:"txt-compact-small-plus flex h-full select-none items-center justify-center px-2 py-0.5",children:n.name}),e.jsx("button",{type:"button",onClick:()=>a(n.code),className:"focus-visible:bg-ui-bg-field-hover transition-fg hover:bg-ui-bg-field-hover flex h-full w-7 items-center justify-center border-l outline-none",children:e.jsx(ue,{className:"text-ui-fg-muted"})})]}),Ye=()=>{const{store:n,isPending:a,isError:m,error:c}=Z(),h=((n==null?void 0:n.supported_currencies)??[]).map(o=>ne[o.currency_code.toUpperCase()]),{payment_providers:v=[]}=me({is_enabled:!0});if(m)throw c;return e.jsx(g,{children:!a&&n&&e.jsx(pe,{currencies:h,paymentProviders:v})})};export{Ye as Component};
