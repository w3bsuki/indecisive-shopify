import{K as y}from"./chunk-6HTZNHPT-Cb4WOymP.js";import{R as m,u as _}from"./chunk-4TC5YS65-CpYb4tqr.js";import{R as v,aT as N,j as e,b as C,c$ as k,a8 as S,w,t as f,B as b,H as F,v as r,I as E,aa as H,ab as L,ac as t}from"./index-DuPjH3KB.js";import"./prompt-BdJTBwZe.js";var M=t.object({labels:t.array(t.object({tracking_number:t.string(),tracking_url:t.string().optional(),label_url:t.string().optional()})),send_notification:t.boolean().optional()});function R({order:d,fulfillment:n}){const{t:s}=C(),{handleSuccess:h}=_(),{mutateAsync:u,isPending:j}=k(d.id,n==null?void 0:n.id),i=S({defaultValues:{send_notification:!d.no_notification},resolver:L(M)}),{fields:x,append:p}=w({name:"labels",control:i.control}),g=i.handleSubmit(async o=>{var c;const l=o.labels.filter(a=>!!a.tracking_number).map(a=>({tracking_number:a.tracking_number,tracking_url:"#",label_url:"#"}));await u({items:(c=n==null?void 0:n.items)==null?void 0:c.map(a=>({id:a.line_item_id,quantity:a.quantity})),labels:[...l,...(n==null?void 0:n.labels)||[]],no_notification:!o.send_notification},{onSuccess:()=>{f.success(s("orders.shipment.toastCreated")),h(`/orders/${d.id}`)},onError:a=>{f.error(a.message)}})});return e.jsx(m.Form,{form:i,children:e.jsxs(y,{onSubmit:g,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(m.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(b,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(b,{size:"small",type:"submit",isLoading:j,children:s("actions.save")})]})}),e.jsx(m.Body,{className:"flex h-full w-full flex-col items-center divide-y overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsx("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(F,{className:"mb-4",children:s("orders.shipment.title")}),x.map((o,l)=>e.jsx(r.Field,{control:i.control,name:`labels.${l}.tracking_number`,render:({field:c})=>e.jsxs(r.Item,{className:"mb-4",children:[l===0&&e.jsx(r.Label,{children:s("orders.shipment.trackingNumber")}),e.jsx(r.Control,{children:e.jsx(E,{...c,placeholder:"123-456-789"})}),e.jsx(r.ErrorMessage,{})]})},o.id)),e.jsx(b,{type:"button",onClick:()=>p({tracking_number:""}),className:"self-end",variant:"secondary",children:s("orders.shipment.addTracking")})]}),e.jsx("div",{className:"mt-8 pt-8 ",children:e.jsx(r.Field,{control:i.control,name:"send_notification",render:({field:{onChange:o,value:l,...c}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r.Label,{children:s("orders.shipment.sendNotification")}),e.jsx(r.Control,{children:e.jsx(r.Control,{children:e.jsx(H,{checked:!!l,onCheckedChange:o,...c})})})]}),e.jsx(r.Hint,{className:"!mt-1",children:s("orders.shipment.sendNotificationHint")}),e.jsx(r.ErrorMessage,{})]})})})]})})})})]})})}function B(){var x;const{id:d,f_id:n}=v(),{order:s,isLoading:h,isError:u,error:j}=N(d,{fields:"*fulfillments,*fulfillments.items,*fulfillments.labels"});if(u)throw j;const i=!h&&s;return e.jsx(m,{children:i&&e.jsx(R,{order:s,fulfillment:(x=s.fulfillments)==null?void 0:x.find(p=>p.id===n)})})}export{B as Component};
